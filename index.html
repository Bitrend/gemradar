<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GemRadar - Mercado Cripto en Tiempo Real</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #2563eb;
            --secondary: #1e40af;
            --dark: #0f172a;
            --light: #f8fafc;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', 'Segoe UI', sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--dark), #1e293b);
            color: var(--light);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Header mejorado */
        header {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(10px);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Nuevo diseño de tarjetas */
        .crypto-card {
            background: rgba(30, 41, 59, 0.6);
            border-radius: 12px;
            padding: 1.25rem;
            transition: all 0.3s ease;
            border-left: 3px solid var(--primary);
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }

        /* Gráficos integrados */
        .chart-container {
            height: 120px;
            margin-top: 10px;
        }

        /* Sección de monetización */
        .monetization-section {
            background: rgba(30, 41, 59, 0.7);
            border-radius: 12px;
            padding: 1.5rem;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        /* Responsive mejorado */
        @media (max-width: 768px) {
            .crypto-grid {
                grid-template-columns: 1fr;
            }
            
            .dashboard {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <!-- Mismo header de versiones anteriores -->
    </header>

    <main class="container">
        <!-- Sección principal de criptomonedas -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Mercado en Tiempo Real</h3>
                <button class="refresh-btn" id="refreshData">
                    <i class="fas fa-sync-alt"></i> Actualizar
                </button>
            </div>
            <div id="cryptoContainer" class="crypto-grid"></div>
        </div>

        <!-- Nuevo: Gráfico del mercado -->
        <div class="card">
            <h3 class="card-title">Capitalización del Mercado (Últimos 7 días)</h3>
            <canvas id="marketChart" height="300"></canvas>
        </div>

        <!-- Sección de monetización -->
        <div class="monetization-section">
            <div class="donation-option">
                <h3><i class="fab fa-bitcoin"></i> Donar con Cripto</h3>
                <div class="qr-codes">
                    <div class="qr-item">
                        <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=bitcoin:bc1qtu5v5k9x7u0q0q0q0q0q0q0q0q0q0q0q0q0" alt="BTC QR">
                        <span>Bitcoin</span>
                    </div>
                    <!-- Más opciones -->
                </div>
            </div>
            
            <div class="ad-option">
                <h3><i class="fas fa-ad"></i> Publicidad</h3>
                <div id="adContainer">
                    <!-- Espacio para Adsense/Adsterra -->
                    <div class="ad-placeholder">
                        <p>Espacio publicitario disponible</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // API REAL: CoinCap (gratis, sin CORS issues)
        const API_URL = "https://api.coincap.io/v2";

        // Elementos DOM
        const DOM = {
            cryptoContainer: document.getElementById('cryptoContainer'),
            refreshBtn: document.getElementById('refreshData'),
            marketChart: document.getElementById('marketChart')
        };

        // Obtener datos REALES
        async function getRealTimeData() {
            try {
                // Top 100 criptomonedas
                const assetsRes = await fetch(`${API_URL}/assets?limit=100`);
                const assetsData = await assetsRes.json();
                
                // Datos del mercado
                const marketRes = await fetch(`${API_URL}/markets`);
                const marketData = await marketRes.json();
                
                return {
                    assets: assetsData.data,
                    markets: marketData.data
                };
            } catch (error) {
                console.error("Error fetching data:", error);
                return { error: true };
            }
        }

        // Renderizar datos
        function renderCryptoData(assets) {
            let html = '';
            
            assets.slice(0, 12).forEach(asset => {
                const change = parseFloat(asset.changePercent24Hr).toFixed(2);
                const changeClass = change >= 0 ? 'positive' : 'negative';
                
                html += `
                <div class="crypto-card">
                    <div class="crypto-header">
                        <img src="https://cryptologos.cc/logos/${asset.id}-${asset.symbol.toLowerCase()}-logo.png" 
                             alt="${asset.name}" 
                             class="crypto-icon">
                        <div>
                            <span class="crypto-name">${asset.name}</span>
                            <span class="crypto-symbol">${asset.symbol}</span>
                        </div>
                    </div>
                    
                    <div class="price-info">
                        <div class="crypto-price">$${parseFloat(asset.priceUsd).toFixed(4)}</div>
                        <div class="price-change ${changeClass}">${change}%</div>
                    </div>
                    
                    <div class="chart-container">
                        <canvas id="chart-${asset.id}" height="100"></canvas>
                    </div>
                </div>
                `;
            });
            
            DOM.cryptoContainer.innerHTML = html;
            
            // Renderizar mini-gráficos
            assets.slice(0, 12).forEach(asset => {
                renderMiniChart(asset.id, asset.history);
            });
        }

        // Renderizar gráfico principal
        function renderMarketChart(data) {
            const ctx = DOM.marketChart.getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.labels,
                    datasets: [{
                        label: 'Capitalización (Billones USD)',
                        data: data.values,
                        borderColor: '#3b82f6',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false }
                    }
                }
            });
        }

        // Monetización: Cargar Adsterra (pagos diarios)
        function loadAdsterra() {
            const script = document.createElement('script');
            script.src = 'https://www.adsterra.com/render.js';
            script.async = true;
            script.onload = () => {
                Adsterra.recommend({
                    websiteKey: 'TU_CLAVE_AQUI', // Registrar en adsterra.com
                    format: 'vignette',
                    selector: '#adContainer'
                });
            };
            document.head.appendChild(script);
        }

        // Inicialización
        async function init() {
            const { assets, markets, error } = await getRealTimeData();
            
            if (error) {
                DOM.cryptoContainer.innerHTML = `
                    <div class="error-message">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>Error al cargar datos. Intentando nuevamente...</p>
                    </div>
                `;
                setTimeout(init, 5000);
                return;
            }
            
            renderCryptoData(assets);
            renderMarketChart(prepareChartData(assets));
            loadAdsterra();
        }

        // Eventos
        DOM.refreshBtn.addEventListener('click', init);

        // Iniciar al cargar
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
